<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>APO Tracker</title>

<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700;900&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{box-sizing:border-box}

body{
  margin:0;
  font-family:'Cinzel',serif;
  color:#ffd6d6;
  background:
    linear-gradient(rgba(0,0,0,.85), rgba(0,0,0,.95)),
    url("/static/bg.jpg") center/cover no-repeat fixed;
}

/* ===== HEADER ===== */
header{
  text-align:center;
  padding:25px;
}
#mainLogo{
  max-width:380px;
  filter:drop-shadow(0 0 25px rgba(255,0,0,.8));
}

/* ===== CLOCK ===== */
#clock{
  position:fixed;
  top:20px;
  right:25px;
  text-align:right;
  font-size:22px;
  color:#ff7a7a;
  text-shadow:0 0 12px rgba(255,0,0,.7);
}
#clock span{
  display:block;
  font-size:14px;
  color:#ffaaaa;
}

/* ===== LAYOUT ===== */
.container{
  max-width:1100px;
  margin:auto;
  padding:20px;
}

/* ===== CARDS ===== */
.card{
  background:rgba(15,0,0,.65);
  border:1px solid rgba(255,0,0,.4);
  border-radius:12px;
  padding:18px;
  margin-bottom:20px;
  backdrop-filter:blur(4px);
}

.section-title{
  font-size:20px;
  color:#ff7a7a;
  margin-bottom:10px;
}

/* ===== INPUTS ===== */
input,button{
  background:#0b0000;
  color:#ffd0d0;
  border:1px solid #aa2222;
  padding:8px 14px;
  font-family:'Cinzel',serif;
}
button{cursor:pointer}

/* ===== CHARACTER ===== */
#charHeader{
  display:flex;
  align-items:center;
  gap:25px;
  margin-top:10px;
}
#vocationIcon{
  width:120px;
  height:auto;
}
#charInfo{
  font-size:20px;
  line-height:1.5;
}

/* ===== TABLE ===== */
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  border:1px solid rgba(255,255,255,.1);
  padding:6px;
  text-align:center;
}
th{
  background:rgba(40,0,0,.85);
  color:#ff9a9a;
}

/* ===== HIGHLIGHT ===== */
.highlight{
  background:rgba(255,0,0,.15);
  padding:10px;
  border:1px solid rgba(255,0,0,.4);
  margin-bottom:10px;
}

/* ===== FOOTER ===== */
footer{
  text-align:right;
  padding:10px 20px;
  font-size:12px;
  color:#aa5555;
}
</style>
</head>

<body>

<header>
  <img src="/static/header/apo-tracker.png" id="mainLogo">
</header>

<div id="clock"></div>

<div class="container">

<div class="card">
  <div class="section-title">PostaÄ‡</div>
  Nick:
  <input id="charName">
  <button onclick="setChar()">Ustaw</button>

  <div id="charHeader">
    <img id="vocationIcon" src="/static/icons/rook.png">
    <div id="charInfo">â€”</div>
  </div>
</div>

<div class="card">
  <div class="section-title">EXP</div>
  <button onclick="refreshExp()">OdÅ›wieÅ¼</button>
  <div id="expInfo">â€”</div>
</div>

<div class="card">
  <div class="section-title">Best Speed Ever</div>
  <div id="bestSpeed" class="highlight">â€”</div>
</div>

<div class="card">
  <div class="section-title">Speed</div>
  <button onclick="startSpeed()">START</button>
  <button onclick="stopSpeed()">STOP</button>
  <div id="speedInfo">â€”</div>
</div>

<div class="card">
  <div class="section-title">Ranking SpeedÃ³w</div>
  <table id="speedTable">
    <thead>
      <tr><th>#</th><th>Data</th><th>EXP</th><th>EXP/min</th><th></th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

</div>

<footer>designed by Zohanek Â© <span id="year"></span></footer>

<script>
/* ===== CONFIG ===== */
const API_URL = "https://TWOJ-RENDER.onrender.com";

/* ===== CLOCK ===== */
function updateClock(){
  const d=new Date();
  clock.innerHTML=d.toLocaleTimeString()+"<span>"+d.toLocaleDateString()+"</span>";
}
setInterval(updateClock,1000);
updateClock();

/* ===== STATE ===== */
let char="";
let speedStart=0, speedTime=0;
let speeds=JSON.parse(localStorage.getItem("speeds"))||[];

/* ===== API ===== */
async function fetchPlayer(){
  const r=await fetch(`${API_URL}/player/${char}`);
  if(!r.ok) throw new Error("API ERROR");
  return r.json();
}

/* ===== VOC ICON ===== */
function vocationIconName(v){
  v=v.toLowerCase();
  if(v.includes("druid"))return"druid.png";
  if(v.includes("paladin"))return"paladin.png";
  if(v.includes("knight"))return"knight.png";
  if(v.includes("sorcerer"))return"sorcerer.png";
  return"rook.png";
}

/* ===== CHARACTER ===== */
function setChar(){
  char=charName.value.trim();
  refreshExp();
}

async function refreshExp(){
  if(!char) return;
  const d=await fetchPlayer();
  vocationIcon.src="/static/icons/"+vocationIconName(d.vocation);
  charInfo.innerHTML=`
    <b>${d.name}</b><br>
    Level: ${d.level}<br>
    Magic: ${d.magic}<br>
    Vocation: ${d.vocation.replace("Paladin","Paladyn")}
  `;
  expInfo.innerHTML=`EXP: <b>${d.experience.toLocaleString()}</b>`;
}

/* ===== SPEED ===== */
async function startSpeed(){
  const d=await fetchPlayer();
  speedStart=d.experience;
  speedTime=Date.now();
}

async function stopSpeed(){
  const d=await fetchPlayer();
  const min=(Date.now()-speedTime)/60000;
  const gain=d.experience-speedStart;
  const epm=Math.round(gain/min);
  speeds.push({date:new Date().toLocaleString(),exp:gain,epm});
  localStorage.setItem("speeds",JSON.stringify(speeds));
  speedInfo.innerText=`${gain} EXP / ${epm} EXP/min`;
  renderSpeed();
  updateBestSpeed();
}

/* ===== SPEED UI ===== */
function renderSpeed(){
  const tbody=speedTable.querySelector("tbody");
  tbody.innerHTML="";
  [...speeds].sort((a,b)=>b.epm-a.epm).forEach((s,i)=>{
    tbody.innerHTML+=`
      <tr>
        <td>${i+1}</td>
        <td>${s.date}</td>
        <td>${s.exp}</td>
        <td><b>${s.epm}</b></td>
        <td><button onclick="delSpeed(${i})">ðŸ—‘</button></td>
      </tr>`;
  });
}
function delSpeed(i){
  speeds.splice(i,1);
  localStorage.setItem("speeds",JSON.stringify(speeds));
  renderSpeed();
  updateBestSpeed();
}
function updateBestSpeed(){
  if(!speeds.length){bestSpeed.innerText="â€”";return;}
  const b=[...speeds].sort((a,b)=>b.epm-a.epm)[0];
  bestSpeed.innerHTML=`${b.epm} EXP/min<br>${b.date}`;
}

/* INIT */
renderSpeed();
updateBestSpeed();
document.getElementById("year").innerText=new Date().getFullYear();
</script>

</body>
</html>
