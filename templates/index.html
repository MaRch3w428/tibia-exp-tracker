<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>APO Tracker</title>

<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700;900&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{box-sizing:border-box}

/* ===== GLOBAL ===== */
body{
  margin:0;
  font-family:'Cinzel',serif;
  color:#f2c6c6;
  background:
    linear-gradient(rgba(0,0,0,.8), rgba(0,0,0,.95)),
    url("/static/bg.jpg") center/cover no-repeat fixed;
}

/* ===== HEADER ===== */
header{
  text-align:center;
  padding:30px;
}
#mainLogo{
  max-width:360px;
  filter:drop-shadow(0 0 25px rgba(255,0,0,.8));
}

/* ===== LAYOUT ===== */
.container{
  max-width:1100px;
  margin:auto;
  padding:20px;
}

/* ===== CARDS ===== */
.card{
  background:rgba(15,0,0,.65);
  border:1px solid rgba(255,0,0,.4);
  border-radius:12px;
  padding:18px;
  margin-bottom:20px;
  backdrop-filter:blur(4px);
}

.section-title{
  font-size:20px;
  color:#ff7a7a;
  margin-bottom:10px;
}

/* ===== INPUTS ===== */
input,button{
  background:#0b0000;
  color:#ffd0d0;
  border:1px solid #aa2222;
  padding:8px 14px;
  font-family:'Cinzel',serif;
}
button{cursor:pointer}

/* ===== CHARACTER ===== */
#charHeader{
  display:flex;
  align-items:center;
  gap:20px;
  margin-top:10px;
}
#vocationIcon{
  width:120px;
  height:auto;
}
#charInfo{
  font-size:20px;
  line-height:1.4;
}

/* ===== TABLE ===== */
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  border:1px solid rgba(255,255,255,.1);
  padding:6px;
  text-align:center;
}
th{
  background:rgba(40,0,0,.8);
  color:#ff9a9a;
}

/* ===== HIGHLIGHTS ===== */
.highlight{
  background:rgba(255,0,0,.15);
  padding:10px;
  border:1px solid rgba(255,0,0,.4);
  margin-bottom:10px;
}

/* ===== FOOTER ===== */
footer{
  text-align:right;
  padding:10px 20px;
  font-size:12px;
  color:#aa5555;
}
</style>
</head>

<body>

<header>
  <img src="/static/header/apo-tracker.png" id="mainLogo">
</header>

<div class="container">

<!-- POSTAÄ† -->
<div class="card">
  <div class="section-title">PostaÄ‡</div>
  Nick:
  <input id="charName">
  <button onclick="setChar()">Ustaw</button>

  <div id="charHeader">
    <img id="vocationIcon" src="/static/icons/rook.png">
    <div id="charInfo">â€”</div>
  </div>
</div>

<!-- EXP -->
<div class="card">
  <div class="section-title">EXP</div>
  <button onclick="refreshExp()">OdÅ›wieÅ¼</button>
  <div id="expInfo">â€”</div>
</div>

<!-- BEST SPEED -->
<div class="card">
  <div class="section-title">Best Speed Ever</div>
  <div id="bestSpeed" class="highlight">â€”</div>
</div>

<!-- SPEED -->
<div class="card">
  <div class="section-title">Speed</div>
  <button onclick="startSpeed()">START</button>
  <button onclick="stopSpeed()">STOP</button>
  <div id="speedInfo">â€”</div>
</div>

<!-- RANKING -->
<div class="card">
  <div class="section-title">Ranking SpeedÃ³w</div>
  <table id="speedTable">
    <thead>
      <tr><th>#</th><th>Data</th><th>EXP</th><th>EXP/min</th><th></th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- DAYS -->
<div class="card">
  <div class="section-title">Dni</div>
  <div id="bestDay" class="highlight">â€”</div>
</div>

<!-- CHART -->
<div class="card">
  <div class="section-title">Wykres EXP (X: dzieÅ„ / Y: EXP)</div>
  <canvas id="expChart" height="120"></canvas>
</div>

</div>

<footer>designed by Zohanek Â© <span id="year"></span></footer>

<script>
document.getElementById("year").innerText=new Date().getFullYear();

/* ===== STATE ===== */
let char="";
let speedStart=0,speedTime=0;
let history=JSON.parse(localStorage.getItem("days"))||[];
let speeds=JSON.parse(localStorage.getItem("speeds"))||[];
let chart=null;

/* ===== MOCK PLAYER (fallback) ===== */
function mockPlayer(){
  return {
    name: char || "Demo",
    level: 120,
    magic: 60,
    experience: Math.floor(Math.random()*1e7)+1e7,
    vocation: "Knight"
  };
}

/* ===== VOC ICON ===== */
function vocationIcon(v){
  v=v.toLowerCase();
  if(v.includes("druid"))return"druid.png";
  if(v.includes("paladin"))return"paladin.png";
  if(v.includes("knight"))return"knight.png";
  if(v.includes("sorcerer"))return"sorcerer.png";
  return"rook.png";
}

/* ===== CHARACTER ===== */
function setChar(){
  char=charName.value.trim();
  refreshExp();
}

function refreshExp(){
  const d=mockPlayer();
  vocationIconImg=vocationIcon(d.vocation);
  vocationIcon.src="/static/icons/"+vocationIconImg;

  charInfo.innerHTML=`
    <b>${d.name}</b><br>
    Level: ${d.level}<br>
    Magic: ${d.magic}<br>
    Vocation: ${d.vocation}
  `;
  expInfo.innerHTML=`EXP: <b>${d.experience.toLocaleString()}</b>`;
}

/* ===== SPEED ===== */
function startSpeed(){
  speedStart=mockPlayer().experience;
  speedTime=Date.now();
}

function stopSpeed(){
  const endExp=mockPlayer().experience;
  const min=(Date.now()-speedTime)/60000;
  const gain=endExp-speedStart;
  const epm=Math.round(gain/min);

  const entry={
    date:new Date().toLocaleString(),
    exp:gain,
    epm
  };

  speeds.push(entry);
  localStorage.setItem("speeds",JSON.stringify(speeds));

  speedInfo.innerText=`${gain} EXP / ${epm} EXP/min`;
  renderSpeed();
  updateBestSpeed();
}

/* ===== SPEED RANK ===== */
function renderSpeed(){
  const tbody=speedTable.querySelector("tbody");
  tbody.innerHTML="";
  [...speeds].sort((a,b)=>b.epm-a.epm).forEach((s,i)=>{
    tbody.innerHTML+=`
      <tr>
        <td>${i+1}</td>
        <td>${s.date}</td>
        <td>${s.exp}</td>
        <td><b>${s.epm}</b></td>
        <td><button onclick="delSpeed(${i})">ðŸ—‘</button></td>
      </tr>`;
  });
}
function delSpeed(i){
  speeds.splice(i,1);
  localStorage.setItem("speeds",JSON.stringify(speeds));
  renderSpeed();
  updateBestSpeed();
}

/* ===== BEST SPEED ===== */
function updateBestSpeed(){
  if(!speeds.length){bestSpeed.innerText="â€”";return;}
  const b=[...speeds].sort((a,b)=>b.epm-a.epm)[0];
  bestSpeed.innerHTML=`${b.epm} EXP/min<br>${b.date}`;
}

/* ===== CHART ===== */
function updateChart(){
  const labels=history.map(d=>d.date);
  const data=history.map(d=>d.exp);
  if(!chart){
    chart=new Chart(expChart,{
      type:"line",
      data:{labels,datasets:[{
        label:"EXP dzienny",
        data,
        borderColor:"red",
        fill:false
      }]},
      options:{
        scales:{
          x:{title:{display:true,text:"DzieÅ„"}},
          y:{title:{display:true,text:"Zdobyty EXP"}}
        }
      }
    });
  }else{
    chart.data.labels=labels;
    chart.data.datasets[0].data=data;
    chart.update();
  }
}

/* INIT */
renderSpeed();
updateBestSpeed();
updateChart();
</script>

</body>
</html>
