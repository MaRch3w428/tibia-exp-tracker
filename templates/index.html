<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>APO EXP Tracker</title>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}

body{
  margin:0;
  font-family:'Cinzel',serif;
  color:#f2caca;
  background:
    linear-gradient(rgba(0,0,0,.85), rgba(0,0,0,.95)),
    url("/static/bg.jpg") center/cover no-repeat fixed;
}

/* ===== CLOCK ===== */
#clock{
  position:fixed;
  top:20px;
  right:25px;
  text-align:right;
  font-size:22px;
  color:#ff4a4a;
  text-shadow:0 0 10px rgba(255,0,0,.7);
}
#clock span{
  display:block;
  font-size:14px;
  color:#ffaaaa;
}

/* ===== HEADER ===== */
header{
  text-align:center;
  padding:30px 20px;
}
header img{
  max-width:420px;
  filter:drop-shadow(0 0 25px rgba(255,0,0,.8));
}

/* ===== LAYOUT ===== */
.container{
  max-width:900px;
  margin:auto;
  padding:20px;
}

.card{
  background:rgba(20,0,0,.7);
  border:1px solid rgba(255,0,0,.4);
  border-radius:14px;
  padding:20px;
  margin-bottom:20px;
  backdrop-filter:blur(4px);
}

h2{
  margin:0 0 15px;
  color:#ff6a6a;
}

/* ===== INPUT ===== */
input,button{
  background:#0b0000;
  color:#ffd0d0;
  border:1px solid #aa2222;
  padding:8px 14px;
  font-family:'Cinzel',serif;
}
button{cursor:pointer}

/* ===== CHAR ===== */
#charBox{
  display:flex;
  align-items:center;
  gap:25px;
  margin-top:15px;
}
#vocationIcon{
  width:130px;
  height:auto;
}
#charInfo{
  font-size:20px;
  line-height:1.5;
}

/* ===== FOOTER ===== */
footer{
  text-align:right;
  padding:10px 20px;
  font-size:12px;
  color:#aa5555;
}
</style>
</head>

<body>

<div id="clock"></div>

<header>
  <img src="/static/header/apo-tracker.png" alt="APO Tracker">
</header>

<div class="container">

<div class="card">
  <h2>Postać</h2>
  Nick:
  <input id="charName">
  <button onclick="setChar()">Ustaw</button>

  <div id="charBox">
    <img id="vocationIcon" src="/static/icons/rook.png">
    <div id="charInfo">—</div>
  </div>
</div>

<div class="card">
  <h2>EXP</h2>
  <button onclick="refresh()">Odśwież</button>
  <div id="expInfo">—</div>
</div>

</div>

<footer>
  designed by Zohanek © <span id="year"></span>
</footer>

<script>
/* ===== CLOCK ===== */
function updateClock(){
  const d=new Date();
  clock.innerHTML=d.toLocaleTimeString()+"<span>"+d.toLocaleDateString()+"</span>";
}
setInterval(updateClock,1000);
updateClock();
year.innerText=new Date().getFullYear();

/* ===== STATE ===== */
let currentChar="";

/* ===== ICON MAP ===== */
function iconFor(v){
  switch(v){
    case "Druid": return "druid.png";
    case "Paladyn": return "paladin.png";
    case "Knight": return "knight.png";
    case "Czarodziej": return "sorcerer.png";
    default: return "rook.png";
  }
}

/* ===== ACTIONS ===== */
function setChar(){
  currentChar = charName.value.trim();
  refresh();
}

async function refresh(){
  if(!currentChar) return;

  try{
    const r = await fetch(`/player/${currentChar}`);
    if(!r.ok) throw "API error";
    const d = await r.json();

    vocationIcon.src = "/static/icons/" + iconFor(d.vocation);

    charInfo.innerHTML = `
      <b>${d.name}</b><br>
      Level: ${d.level}<br>
      Magic: ${d.magic}<br>
      Profesja: ${d.vocation}
    `;

    expInfo.innerHTML = `EXP: <b>${d.experience.toLocaleString()}</b>`;
  }catch(e){
    alert("Błąd pobierania danych postaci");
  }
}
</script>

</body>
</html>
